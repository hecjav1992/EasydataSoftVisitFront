<div class="row justify-content-center">
  <div class="card bg-body-tertiary rounded shadow">
    hola soy molina
    <!-- Cabecera con logo y usuario -->
    <div class="row g-0 d-flex justify-content-center align-items-center p-3">
      <img src="../../assets/img/avicola.jpg" class="img-fluid w-100 mb-3" alt="Imagen superior">
      <div class="col-4 text-center">
        <img src="../../assets/img/logo.png" class="img-fluid" alt="Logo">
      </div>
      <div class="col-8">
        <h5 class="mb-0">Usuario: {{mensaje}}</h5>
      </div>
    </div>

    <!-- Formulario -->
    <div class="card-body">
      <h4 class="card-title text-primary mb-4 text-center">Formulario de Pedido</h4>

      <form (ngSubmit)="enviar()" id="pedidoForm" class="row g-3 needs-validation" novalidate>
        <div class="mb-3">
          <label for="usuario" class="form-label">Usuario:</label>
          <input type="text" class="form-control" id="usuario" name="usuario" value="{{mensaje}}" readonly>
        </div>

        <div class="mb-3">
          <label for="fechaHora" class="form-label">Fecha y Hora:</label>
          <input [(ngModel)]="fecha" class="form-control" id="fechaHora" name="fechaHora" value="{{fecha}}" readonly>
        </div>

        <div class="mb-3">
          <label for="producto" class="form-label">Producto:</label>
            <input type="text" [(ngModel)]="item" class="form-control" (blur)="validarProducto()"  matInput [formControl]="myControl" [matAutocomplete]="auto" required>
            <mat-autocomplete id="matAutocomplete" #auto="matAutocomplete" >
              <mat-option id="mat" *ngFor="let item of filteredOptions | async" [value]="item.nombre" (mousedown)=$event.preventDefault() >
                {{item.nombre}}
              </mat-option>
            </mat-autocomplete>
      
        </div>

        <div class="mb-3">
          <label for="cantidad" class="form-label">Cantidad:</label>
          <input [(ngModel)]="cantidad" type="number" class="form-control" id="cantidad" name="cantidad" required>
        </div>

        <div class="mb-3">
          <label for="direccion" class="form-label">Dirección de entrega:</label>
          <input [(ngModel)]="direccion" type="text" class="form-control" id="direccion" name="direccion" required>
        </div>
        <div class="mb-3">
          <label for="telefono" class="form-label">Teléfono de contacto:</label>
          <input [(ngModel)]="telefono" type="text" class="form-control" id="telefono" name="telefono" required>
        </div>

        <div class="mb-3">
          <label for="comentarios" class="form-label">Comentarios:</label>
          <textarea [(ngModel)]="observaciones" type="text" class="form-control" id="comentarios" name="comentarios"></textarea>
        </div>

        <div class="d-grid d-md-flex justify-content-md-between gap-2">
          <button type="submit" class="btn btn-success col col-sm-4">Enviar Pedido</button>
          <button type="button" class="btn btn-primary col col-sm-4" (click)=verificarPedidos()>Consultar Pedido</button>
          <button type="button" class="btn btn-danger col col-sm-4" (click)="cerrarApp()" id="cancelarBtn">Salir</button>
        </div>
      </form>
    </div>
  </div>
</div>
<div class="modal fade" id="loadingModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content d-flex justify-content-center align-items-center p-4" style="height: 200px;">
      <div class="text-center">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <h5 class="mt-3">Procesando, por favor espere...</h5>
      </div>
    </div>
  </div>
</div>


<!-- Modal Pedidos -->
<div class="modal fade" id="pedidosModal" tabindex="-1" aria-labelledby="pedidosModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <!-- modal grande para que quepa la tabla -->
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="pedidosModalLabel">Detalle de Pedidos</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <!-- Buscador -->
        <div class="buscador">
          <input type="search" placeholder="Buscar pedido o cliente..." oninput="filtrar(this.value)">
          <select id="filtroEstado" onchange="filtrarEstado(this.value)">
            <option value="">Todos los estados</option>
            <option>Pendiente</option>
            <option>En proceso</option>
            <option>Completado</option>
            <option>Cancelado</option>
          </select>
        </div>

        <div class="overflow-scroll">
          <table class="tabla table-resonsive table" id="tablaPedidos" aria-label="Tabla de pedidos">
            <thead>
              <tr>
                <th>ID Pedido</th>
                <th>Cliente</th>
                <th>Fecha</th>
                <th>Estado</th>
                <th>Total</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>PD-1001</td>
                <td>Ana López</td>
                <td>2025-08-15</td>
                <td><span class="badge pendiente">Pendiente</span></td>
                <td>$145.90</td>
                <td class="acciones">
                  <button class="btn-editar" onclick="alert('Editar PD-1001')">Editar</button>
                  <button class="btn-borrar" onclick="borrar(this)">Borrar</button>
                </td>
              </tr>
              <tr>
                <td>PD-1002</td>
                <td>Carlos Pérez</td>
                <td>2025-08-16</td>
                <td><span class="badge en-proceso">En proceso</span></td>
                <td>$89.50</td>
                <td class="acciones">
                  <button class="btn-editar" onclick="alert('Editar PD-1002')">Editar</button>
                  <button class="btn-borrar" onclick="borrar(this)">Borrar</button>
                </td>
              </tr>
              <tr>
                <td>PD-1003</td>
                <td>María Gómez</td>
                <td>2025-08-17</td>
                <td><span class="badge completado">Completado</span></td>
                <td>$210.00</td>
                <td class="acciones">
                  <button class="btn-editar" onclick="alert('Editar PD-1003')">Editar</button>
                  <button class="btn-borrar" onclick="borrar(this)">Borrar</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer d-flex justify-content-center">
        <button type="button" class="btn btn-danger form-control" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<!-- Estilos fuera del modal -->
<style>
  .tabla {
    width: 100%;
    border-collapse: collapse;
    border-radius: 12px;
    overflow: hidden;
  }

    .tabla th, .tabla td {
      padding: 10px 14px;
      text-align: left;
    }

    .tabla thead th {
      background: #f4f6f8;
      font-weight: 600;
    }

    .tabla tbody tr:nth-child(even) {
      background: #fafafa;
    }

  .badge {
    padding: 4px 10px;
    border-radius: 999px;
    font-size: .85rem;
  }

  .pendiente {
    background: #fff7ed;
    color: #9a3412;
  }

  .en-proceso {
    background: #eff6ff;
    color: #1d4ed8;
  }

  .completado {
    background: #ecfdf5;
    color: #047857;
  }

  .cancelado {
    background: #fef2f2;
    color: #b91c1c;
  }

  .acciones button {
    border: 0;
    padding: 6px 10px;
    border-radius: 8px;
    margin-right: 4px;
    cursor: pointer;
  }

  .btn-ver {
    background: #e0f2fe;
  }

  .btn-editar {
    background: #ede9fe;
  }

  .btn-borrar {
    background: #fee2e2;
  }

  .buscador {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }

    .buscador input, .buscador select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
</style>

<!-- JS funciones -->
<script>
  function borrar(btn) {
    const fila = btn.closest('tr');
    const id = fila.cells[0].innerText;
    if (confirm(`¿Seguro que quieres borrar ${id}?`)) {
      fila.remove();
    }
  }
  function filtrar(texto) {
    const rows = document.querySelectorAll('#tablaPedidos tbody tr');
    const t = texto.toLowerCase();
    rows.forEach(r => {
      const id = r.cells[0].innerText.toLowerCase();
      const cliente = r.cells[1].innerText.toLowerCase();
      r.style.display = (id.includes(t) || cliente.includes(t)) ? '' : 'none';
    });
  }
  function filtrarEstado(estado) {
    const rows = document.querySelectorAll('#tablaPedidos tbody tr');
    rows.forEach(r => {
      const badge = r.cells[3].innerText;
      r.style.display = (!estado || badge === estado) ? '' : 'none';
    });
  }
</script>



